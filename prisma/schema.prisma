generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model AdminUser {
    id        String   @id @default(cuid())
    userid    String   @unique
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    user      User     @relation(fields: [userid], references: [id], onDelete: Cascade)
}

model TextChannel {
    id          String       @id @default(cuid())
    name        String
    serverid    String
    createdAt   DateTime     @default(now())
    updatedAt   DateTime     @updatedAt
    categoryid  String?
    permissions Permission[]
    position    Int          @default(0)
    messages    Message[]
    category    Category?    @relation(fields: [categoryid], references: [id])
    server      Server       @relation(fields: [serverid], references: [id])
}

model VoiceChannel {
    id          String       @id @default(cuid())
    name        String
    serverid    String
    createdAt   DateTime     @default(now())
    updatedAt   DateTime     @updatedAt
    categoryid  String?
    permissions Permission[]
    position    Int          @default(0)
    users       User[]
    category    Category?    @relation(fields: [categoryid], references: [id])
    server      Server       @relation(fields: [serverid], references: [id])
}

model Category {
    id            String         @id @default(cuid())
    name          String
    serverid      String
    permissions   Permission[]
    position      Int            @default(0)
    server        Server         @relation(fields: [serverid], references: [id])
    textchannels  TextChannel[]
    voicechannels VoiceChannel[]
}

model Message {
    id              String      @id @default(cuid())
    content         String
    authorId        String
    color           String?     @default("#fff")
    backgroundColor String?     @default("#00000000")
    createdAt       DateTime    @default(now())
    updatedAt       DateTime    @updatedAt
    textChannelId   String
    author          User        @relation(fields: [authorId], references: [id])
    textChannel     TextChannel @relation(fields: [textChannelId], references: [id])
    mentionedRoles  Role[]      @relation("MessageToRole")
    mentionedUser   User[]      @relation("mentions")
}

model Role {
    id          String       @id @default(cuid())
    name        String
    permissions Permission[]
    serverid    String
    createdAt   DateTime     @default(now())
    updatedAt   DateTime     @updatedAt
    visible     Boolean
    color       String       @default("fff")
    position    Int          @default(0)
    server      Server       @relation(fields: [serverid], references: [id])
    mentionedIn Message[]    @relation("MessageToRole")
    users       User[]       @relation("RoleToUser")
}

model Server {
    id           String         @id @default(cuid())
    name         String
    ownerid      String
    createdAt    DateTime       @default(now())
    updatedAt    DateTime       @updatedAt
    pfp          String         @default("")
    banner       String         @default("")
    categories   Category[]
    roles        Role[]
    owner        User           @relation(fields: [ownerid], references: [id])
    textchannel  TextChannel[]
    voicechannel VoiceChannel[]
    bannedUser   User[]         @relation("bannedusers")
    users        User[]         @relation("users")
    ActionLog    ActionLog[]
}

model Account {
    id                String   @id @default(cuid())
    userId            String
    type              String
    provider          String
    providerAccountId String
    refresh_token     String?
    access_token      String?
    expires_at        Int?
    token_type        String?
    scope             String?
    id_token          String?
    session_state     String?
    createdAt         DateTime @default(now())
    updatedAt         DateTime @updatedAt
    user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([provider, providerAccountId])
}

model Session {
    id           String   @id @default(cuid())
    sessionToken String   @unique
    userId       String
    expires      DateTime
    user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
    id             String        @id @default(cuid())
    name           String
    email          String        @unique
    emailVerified  DateTime?
    image          String
    status         OnlineStatus  @default(OFFLINE)
    createdAt      DateTime      @default(now())
    updatedAt      DateTime      @updatedAt
    voicechannelid String?       @map("voicechannelid")
    accounts       Account[]
    adminuser      AdminUser?
    messages       Message[]
    ownerof        Server[]
    sessions       Session[]
    voicechannel   VoiceChannel? @relation(fields: [voicechannelid], references: [id])
    settings       UserSettings?
    roles          Role[]        @relation("RoleToUser")
    bannedon       Server[]      @relation("bannedusers")
    friends        User[]        @relation("friends")
    friendsWith    User[]        @relation("friends")
    mentionedin    Message[]     @relation("mentions")
    server         Server[]      @relation("users")
    ActionType     ActionType[]
}

model ActionLog {
    id       String       @id @default(cuid())
    server   Server       @relation(fields: [serverId], references: [id])
    serverId String
    actions  ActionType[]
}

model ActionType {
    id          String     @id @default(cuid())
    user        User       @relation(fields: [userId], references: [id])
    userId      String
    action      Action
    actionlog   ActionLog? @relation(fields: [actionlogid], references: [id])
    actionlogid String?
}

model UserSettings {
    id     String @id @default(cuid())
    userid String @unique
    User   User   @relation(fields: [userid], references: [id])
}

model VerificationToken {
    identifier String
    token      String   @unique
    expires    DateTime

    @@unique([identifier, token])
}

enum Permission {
    BAN_MEMBERS
    KICK_MEMBERS
    MANAGE_MEMBERS
    MANAGE_MESSAGES
    MANAGE_SERVER
    READ_MESSAGES
    SEND_MESSAGES
}

enum OnlineStatus {
    ONLINE
    AWAY
    DND
    OFFLINE
}

enum Action {
    // default
    MESSAGE_DELETE
    BAN_USER
    KICK_USER
    // default

    MESSAGE_EDIT
    MESSAGE_SEND
    CREATE_VOICE_CHANNEL
    CREATE_TEXT_CHANNEL
    DELETE_VOICE_CHANNEL
    DELETE_TEXT_CHANNEL
    JOIN_VOICE_CHANNEL
    LEAVE_VOICE_CHANNEL
    JOIN_SERVER
    LEAVE_SERVER
}
